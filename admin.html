<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Bioacoustics</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">Bioacoustics Organization</a>
            <ul class="nav-menu">
                <li><a href="index.html">Inicio</a></li>
                <li><a href="map.html">Mapa</a></li>
                <li><a href="recordings.html">Grabaciones</a></li>
                <li><a href="admin.html" class="active">Admin</a></li>
            </ul>
        </div>
    </nav>

    <main class="container admin-panel">
        <h1>Panel de Administraci√≥n</h1>

        <div class="admin-tabs">
            <button class="tab-btn active" onclick="showTab('upload')">üì§ Subir Archivos</button>
            <button class="tab-btn" onclick="showTab('manage')">üìù Gestionar Grabaciones</button>
            <button class="tab-btn" onclick="showTab('batch')">üìç Geolocalizaci√≥n por Lote</button>
        </div>

        <!-- Upload Tab -->
        <div id="uploadTab" class="tab-content active">
            <h2>Subir Nuevas Grabaciones</h2>
            
            <div class="upload-section">
                <div class="file-upload-area">
                    <h3>1. Subir Archivos de Audio</h3>
                    <input type="file" id="audioFiles" multiple accept="audio/*" class="file-input">
                    <label for="audioFiles" class="file-label">
                        <span>üéµ Seleccionar archivos de audio</span>
                        <small>Puedes seleccionar m√∫ltiples archivos</small>
                    </label>
                    <div id="audioFileList" class="file-list"></div>
                </div>

                <div class="file-upload-area">
                    <h3>2. Subir Espectrogramas (Opcional)</h3>
                    <input type="file" id="spectrogramFiles" multiple accept="image/*" class="file-input">
                    <label for="spectrogramFiles" class="file-label">
                        <span>üìä Seleccionar espectrogramas</span>
                        <small>PNG, JPG - deben coincidir con nombres de audio</small>
                    </label>
                    <div id="spectrogramFileList" class="file-list"></div>
                </div>

                <button onclick="processUploadedFiles()" class="btn btn-primary">
                    Procesar Archivos y Continuar ‚Üí
                </button>
            </div>
        </div>

        <!-- Manage Tab -->
        <div id="manageTab" class="tab-content">
            <h2>Gestionar Grabaciones Existentes</h2>
            
            <div class="search-bar">
                <input type="text" id="searchRecordings" placeholder="Buscar por t√≠tulo, especie o ubicaci√≥n..." 
                       onkeyup="filterRecordings()">
            </div>

            <div id="recordingsList" class="recordings-grid"></div>
        </div>

        <!-- Batch Geolocation Tab -->
        <div id="batchTab" class="tab-content">
            <h2>Geolocalizaci√≥n por Lote</h2>
            <p>Asigna ubicaciones a m√∫ltiples grabaciones que a√∫n no tienen coordenadas.</p>

            <div class="batch-geolocation">
                <div class="batch-list">
                    <h3>Grabaciones sin Geolocalizar</h3>
                    <div id="ungeolocatedList"></div>
                </div>

                <div class="batch-map-container">
                    <h3>Selecciona Ubicaci√≥n en el Mapa</h3>
                    <p>Haz clic en el mapa para establecer coordenadas, o ingr√©salas manualmente:</p>
                    
                    <div class="coord-inputs">
                        <div>
                            <label>Latitud:</label>
                            <input type="number" id="batchLat" step="0.000001" placeholder="-33.4489">
                        </div>
                        <div>
                            <label>Longitud:</label>
                            <input type="number" id="batchLng" step="0.000001" placeholder="-70.6693">
                        </div>
                    </div>

                    <div id="batchMap" style="height: 400px; margin: 1rem 0;"></div>

                    <button onclick="applyBatchLocation()" class="btn btn-primary">
                        Aplicar Ubicaci√≥n a Seleccionadas
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>Editar Grabaci√≥n</h2>
            
            <form id="editForm">
                <input type="hidden" id="editId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label>T√≠tulo *</label>
                        <input type="text" id="editTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Especie</label>
                        <input type="text" id="editSpecies">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Ubicaci√≥n</label>
                        <input type="text" id="editLocation">
                    </div>
                    <div class="form-group">
                        <label>Fecha</label>
                        <input type="date" id="editDate">
                    </div>
                </div>

                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="editDescription" rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label>Grabador</label>
                    <input type="text" id="editRecordist">
                </div>

                <div class="geolocation-section">
                    <h3>Geolocalizaci√≥n</h3>
                    <p>Haz clic en el mapa o ingresa coordenadas manualmente:</p>
                    
                    <div class="coord-inputs">
                        <div>
                            <label>Latitud *</label>
                            <input type="number" id="editLat" step="0.000001" required>
                        </div>
                        <div>
                            <label>Longitud *</label>
                            <input type="number" id="editLng" step="0.000001" required>
                        </div>
                    </div>

                    <div id="editMap" style="height: 300px; margin-top: 1rem;"></div>
                </div>

                <div class="form-actions">
                    <button type="button" onclick="closeEditModal()" class="btn btn-secondary">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/db.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>
